<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gene's Lechon - Products</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/products.css">
</head>
<body>

<div id="toast-container"></div>

<aside id="sidebar-placeholder"></aside>

<main class="main-content">
    <header>
        <div class="header-title">
            <h1 id="pageTitle">Product Management</h1>
            <p id="currentDate">Loading date...</p>
        </div>
        <div class="header-actions">
            <button class="btn-secondary" id="btnToggleArchive" onclick="window.toggleArchiveView()">
                <i class="fas fa-archive"></i> <span>View Archives</span>
            </button>
            <button class="btn-primary" id="btnAddProduct" onclick="window.openProductModal()">
                <i class="fas fa-plus"></i> Add Product
            </button>
        </div>
    </header>

    <div class="controls-row">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="searchInput" placeholder="Search products..." onkeyup="window.filterProducts()" class="search-input">
        </div>
    </div>

    <div class="products-grid" id="productsGrid">
        <div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Loading Products...</div>
    </div>
</main>

<!-- Add/Edit Product Modal -->
<div class="modal" id="productModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Add New Product</h2>
            <button class="close-modal" onclick="window.closeModal('productModal')">×</button>
        </div>
        <form id="productForm" onsubmit="window.handleProductSubmit(event)">
            <input type="hidden" id="editProductId">
            <div class="modal-body-split">
                <div class="image-section">
                    <label>Product Image</label>
                    <div class="img-toggle-container">
                        <button type="button" class="img-toggle-btn active" id="btn-mode-file" onclick="window.toggleImageMode('file')">Upload File</button>
                        <button type="button" class="img-toggle-btn" id="btn-mode-url" onclick="window.toggleImageMode('url')">Image URL</button>
                    </div>
                    <div class="image-upload-container" id="container-file">
                        <div class="image-preview" id="imagePreviewFile">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Click to Upload</span>
                            <input type="file" id="productImageFile" accept="image/*" onchange="window.previewImageFromFile(this)">
                        </div>
                    </div>
                    <div class="image-url-container" id="container-url" style="display: none;">
                        <div class="image-preview" id="imagePreviewUrl">
                            <i class="fas fa-link"></i>
                            <span>Preview</span>
                        </div>
                        <input type="text" id="productImageUrl" class="form-input" placeholder="Paste image link here..." oninput="window.previewImageFromUrl(this.value)" style="margin-top: 10px;">
                    </div>
                    <input type="hidden" id="finalImageSrc">
                </div>
                <div class="info-section">
                    <div class="form-group">
                        <label>Product Name <span class="req">*</span></label>
                        <input type="text" id="prodName" class="form-input" placeholder="e.g. Whole Lechon" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label>Category <span class="req">*</span></label>
                            <select id="prodCategory" class="form-input" required>
                                <option value="" disabled selected>Loading...</option>
                            </select>
                        </div>
                        <div class="form-group half">
                            <label>Price (₱) <span class="req">*</span></label>
                            <input type="number" id="prodPrice" class="form-input" min="0" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Current Stock <span class="req">*</span></label>
                        <input type="number" id="prodQuantity" class="form-input" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="prodDesc" class="form-input" rows="2" placeholder="Short description..."></textarea>
                    </div>
                </div>
            </div>
            <div class="inventory-link-section">
                <div class="section-header-row">
                    <div class="section-label">
                        <i class="fas fa-boxes"></i> Recipe (Inventory Deduction)
                    </div>
                    <button type="button" class="btn-add-ing" onclick="window.addIngredientRow()">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                </div>
                <div id="ingredients-container"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-outline" onclick="window.closeModal('productModal')">Cancel</button>
                <button type="submit" class="btn-primary" id="btnSaveProduct">Save Product</button>
            </div>
        </form>
    </div>
</div>

<!-- Archive Modal -->
<div class="modal" id="archiveModal">
    <div class="modal-content center-content" style="max-width: 350px;">
        <div class="icon-circle warning"><i class="fas fa-archive"></i></div>
        <h3>Archive Product?</h3>
        <p>This will hide <b id="archiveProductName"></b> from the active menu.</p>
        <input type="hidden" id="archiveTargetId">
        <div class="modal-footer center-footer">
            <button class="btn-outline" onclick="window.closeModal('archiveModal')">Cancel</button>
            <button class="btn-warning" onclick="window.confirmArchive()">Yes, Archive</button>
        </div>
    </div>
</div>

<!-- Restore Modal -->
<div class="modal" id="restoreModal">
    <div class="modal-content center-content" style="max-width: 350px;">
        <div class="icon-circle success"><i class="fas fa-undo"></i></div>
        <h3>Restore Product?</h3>
        <p>Bring <b id="restoreProductName"></b> back to the active menu?</p>
        <input type="hidden" id="restoreTargetId">
        <div class="modal-footer center-footer">
            <button class="btn-outline" onclick="window.closeModal('restoreModal')">Cancel</button>
            <button class="btn-success" onclick="window.confirmRestore()">Yes, Restore</button>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal" id="deleteModal">
    <div class="modal-content center-content" style="max-width: 350px;">
        <div class="icon-circle danger"><i class="fas fa-trash-alt"></i></div>
        <h3>Delete Permanently?</h3>
        <p style="color: #d32f2f; font-size: 13px;">This cannot be undone.</p>
        <p>Delete <b id="deleteProductName"></b> forever?</p>
        <input type="hidden" id="deleteTargetId">
        <div class="modal-footer center-footer">
            <button class="btn-outline" onclick="window.closeModal('deleteModal')">Cancel</button>
            <button class="btn-danger" onclick="window.confirmDelete()">Delete Forever</button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script type="module">
    import { initSidebar } from './js/sidebar.js';
    document.addEventListener('DOMContentLoaded', () => { initSidebar(); });
</script>
<script type="module" src="js/products.js"></script>

</body>
</html>